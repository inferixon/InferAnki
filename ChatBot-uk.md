# Посібник з конфігурації ChatBot InferAnki

## Огляд

ChatBot InferAnki - це AI-асистент для вивчення норвезької мови, інтегрований безпосередньо в редактор карток Anki. Він надає контекстну допомогу, пояснення та приклади для вивчення норвезької мови.

## Конфігурація

### Основні налаштування ChatBot

Редагуйте `prompts.json` → розділ `chatbot`:

```json
"chatbot": {
  "system_message": "You are an expert Norwegian language teacher...",
  "api_settings": {
    "model": "gpt-5.2-chat-latest",
    "max_completion_tokens": 800
  }
}
```

### Система швидких промптів

ChatBot має динамічну систему швидких промптів, яка автоматично генерує кнопки на основі конфігурації в `prompts.json`. Кожен швидкий промпт:

1. Бере поточний текст з поля вводу як `{expression}`
2. Використовує вашу налаштовану мову користувача як `{user_lang}` при потребі
3. Форматує попередньо визначений шаблон промпту
4. Надсилає відформатований запит до ChatGPT

### Додавання нових швидких промптів

Щоб додати нову кнопку швидкого промпту:

1. Відкрийте `prompts.json`
2. Знайдіть `"chatbot" → "quick_prompts"`
3. Додайте свій новий промпт:

```json
"prompt_your_new_function": {
  "description": "Що робить цей промпт",
  "button_text": "ТЕКСТ_КНОПКИ",
  "prompt_template": "Ваш промпт тут з {expression} та відповідями {user_lang}",
  "max_completion_tokens": 1000
}
```


4. Перезапустіть Anki - кнопка з'явиться автоматично!


## Змінні шаблонів

Доступні змінні в `prompt_template`:

- `{expression}` - Текст з поля вводу користувача
- `{user_lang}` - Мова користувача з config.json

## Налаштування API для кожного промпту

Кожен швидкий промпт може перевизначити стандартні налаштування API:

```json
"prompt_example": {
  "button_text": "ПРИКЛАД",
  "prompt_template": "...",
  "max_completion_tokens": 1500,  // Перевизначити стандартний ліміт токенів
  "copy_to_clipboard": false       // Контроль `відповіді в буфер`
}
```

## Поради для створення ефективних швидких промптів

1. **Будьте конкретними**: Чіткі інструкції дають кращі результати
2. **Використовуйте контекст**: Включайте призначення та очікуваний формат
3. **Встановлюйте відповідні токени**: Короткі відповіді = 400-800, детальні = 1000-1500
4. **Буфер**: Встановіть `"copy_to_clipboard": true` якщо хочете копіювання відповіді після кожного промпту.
5. **Включайте приклади**: Покажіть AI який формат ви хочете

## Усунення несправностей

### Кнопка не з'являється
- Перевірте синтаксис JSON в `prompts.json`
- Повністю перезапустіть Anki
- Переконайтеся що промпт знаходиться всередині об'єкта `"quick_prompts"`

### Відповіді неправильною мовою
- Перевірте `"user_lang"` в `config.json`
- Переконайтеся що `{user_lang}` використовується в шаблоні промпту
- Перевірте інструкції мови в system_message

### Помилки API
- Перевірте ключ OpenAI API в `config.json`
- Перевірте інтернет-з'єднання

## Примітки щодо продуктивності

- Швидкі промпти очищують поле вводу після виконання
- **Пам'ять розмови**: Чатбот запам'ятовує останні 10 пар повідомлень (20 повідомлень загалом) в межах однієї сесії діалогу
- Кожне нове вікно діалогу починається з чистого аркуша (без пам'яті між сесіями)
- Історія контексту надсилається з кожним запитом до API для зв'язних багатоходових розмов
- Відповіді оптимізовані для стислості для економії токенів
- Встановлюйте відповідні `max_completion_tokens` для контролю витрат

---

> **Пам'ятайте**: Завжди перезапускайте Anki після зміни конфігурації `prompts.json`!
